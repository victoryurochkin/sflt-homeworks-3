# Домашнее задание к занятию 3 «Резервное копирование» - `Юрочкин В.А.`


Подготовительный этап:
На своём домашнем сервере (гипервизоре) поднял виртуалку с ubuntu server 22.04 на ней буду выполнять домашнее задание
<img width="1186" height="425" alt="1" src="https://github.com/user-attachments/assets/32e7d32e-2987-47ad-88b7-87f3f320a60c" />

<img width="966" height="699" alt="1" src="https://github.com/user-attachments/assets/fbe9bd49-fd40-4f2f-ab77-e998006bfb58" />

---

### Задание 1
Составьте команду rsync, которая позволяет создавать зеркальную копию домашней директории пользователя в директорию /tmp/backup
Необходимо исключить из синхронизации все директории, начинающиеся с точки (скрытые)
Необходимо сделать так, чтобы rsync подсчитывал хэш-суммы для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.
На проверку направить скриншот с командой и результатом ее выполнения

`**Решение**`

1. `Для реализации этого задания составлю вот такую команду:`
```
rsync -avc --delete --filter='- .*/' "$HOME"/ /tmp/backup/
```

`что она делает:`

`-a — архивный режим (права, владельцы, рекурсивно и т.д.).
-v — подробный вывод.
-c — сверять файлы по hash-сумме, даже если размер и время модификации совпадают.
--delete — удаляет в /tmp/backup то, чего уже нет в $HOME (зеркальная копия).
--filter='- .*/' — исключает все директории, имена которых начинаются с точкой (и всё их содержимое), но не трогает обычные файлы.`

`Результат её выполнения`
<img width="914" height="360" alt="1" src="https://github.com/user-attachments/assets/f1b40e0d-9e3e-4204-a5e2-81e28a52d091" />

---

### Задание 2
Написать скрипт и настроить задачу на регулярное резервное копирование домашней директории пользователя с помощью rsync и cron.
Резервная копия должна быть полностью зеркальной
Резервная копия должна создаваться раз в день, в системном логе должна появляться запись об успешном или неуспешном выполнении операции
Резервная копия размещается локально, в директории /tmp/backup
На проверку направить файл crontab и скриншот с результатом работы утилиты.

`**Решение**`

1. `Для реализации я создам файл по пути /usr/local/bin/backup_home.sh`

```
nano /usr/local/bin/backup_home.sh
```

```
#!/usr/bin/env bash

SRC="$HOME/"
DEST="/tmp/backup/"
LOGTAG="backup_home_rsync"

# Создаём директорию для бэкапа, если её ещё нет
mkdir -p "$DEST"

# Опции rsync: архивный режим + зеркалирование
RSYNC_OPTS="-a --delete"

# Запускаем rsync и логируем результат в syslog
if rsync $RSYNC_OPTS "$SRC" "$DEST" >/tmp/backup_rsync.log 2>&1; then
    logger -t "$LOGTAG" "Backup succeeded"
else
    logger -t "$LOGTAG" "Backup FAILED. See /tmp/backup_rsync.log"
fi

```

`сделаю его исполняемым`

```
sudo chmod +x /usr/local/bin/backup_home.sh
```

`добавляю задание в "крон"`

```
crontab -e
```

```
0 3 * * * /usr/local/bin/backup_home.sh
```

`запуск каждый день в 03:00`

`тестовый запуск в ручную`

```
/usr/local/bin/backup_home.sh
ls -l /tmp/backup
sudo grep backup_home_rsync /var/log/syslog | tail #смотрю логи что скрипт отработал
```

<img width="807" height="938" alt="1" src="https://github.com/user-attachments/assets/22cf7e30-1ab3-4087-82b4-758d0ce32d84" />
